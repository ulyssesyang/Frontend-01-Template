<!-- antv g6 cdn -->
<script src="https://gw.alipayobjects.com/os/antv/pkg/_antv.g6-3.4.7/dist/g6.min.js"></script>

<body>
    <div id="container" />
</body>
<script>
    const data = {
        id: 'globalThis',
        children: [{
                id: 'Global Value Objects',
                children: [
                    {
                        id: 'Infinity'
                    },
                    {
                        id: 'NaN'
                    },
                    {
                        id: 'undefined'
                    },
                ]
            },
            {
                id: 'Global Function Objects',
                children: [{
                        id: 'eval'
                    },
                    {
                        id: 'isFinite'
                    },
                    {
                        id: 'isNaN'
                    },
                    {
                        id: 'parseFloat'
                    },
                    {
                        id: 'parseInt'
                    },
                    {
                        id: 'URI Handling Functions',
                        children: [{
                                id: 'decodeURI'
                            },
                            {
                                id: 'decodeURIComponent'
                            },
                            {
                                id: 'encodeURI'
                            },
                            {
                                id: 'encodeURIComponent'
                            },
                        ]
                    }
                ]
            },
            {
                id: 'Fundamental Objects',
                children: [{
                        id: 'Object'
                    },
                    {
                        id: 'Function'
                    },
                    {
                        id: 'Boolean'
                    },
                    {
                        id: 'Symbol'
                    },
                    {
                        id: 'Error',
                        children: [{
                                id: 'EvalError'
                            },
                            {
                                id: 'RangeError'
                            },
                            {
                                id: 'ReferenceError'
                            },
                            {
                                id: 'SyntaxError'
                            },
                            {
                                id: 'TypeError'
                            },
                            {
                                id: 'URIError'
                            },
                        ]
                    },
                ]
            },
            {
                id: 'Numbers and Dates',
                children: [{
                        id: 'Number'
                    },
                    {
                        id: 'BigInt'
                    },
                    {
                        id: 'Math'
                    },
                    {
                        id: 'Date'
                    },
                ]
            },
            {
                id: 'Text Processing',
                children: [{
                        id: 'String'
                    },
                    {
                        id: 'RegExp'
                    },
                ]
            },
            {
                id: 'Indexed Collections',
                children: [{
                        id: 'Array',
                    },
                    {
                        id: 'TypedArray',
                        children: [{
                                id: 'Float32Array'
                            },
                            {
                                id: 'Float64Array'
                            },
                            {
                                id: 'Int8Array'
                            },
                            {
                                id: 'Int16Array'
                            },
                            {
                                id: 'Int32Array'
                            },
                            {
                                id: 'BigInt64Array'
                            },
                            {
                                id: 'Uint8Array'
                            },
                            {
                                id: 'Uint16Array'
                            },
                            {
                                id: 'Uint32Array'
                            },
                            {
                                id: 'BigUint64Array'
                            },
                            {
                                id: 'Uint8ClampedArray'
                            },
                        ]
                    },
                ]
            },
            {
                id: 'Keyed Collections',
                children: [{
                        id: 'Map'
                    },
                    {
                        id: 'Set'
                    },
                    {
                        id: 'WeakMap'
                    },
                    {
                        id: 'WeakSet'
                    },
                ]
            },
            {
                id: 'Structured Data',
                children: [{
                        id: 'ArrayBuffer'
                    },
                    {
                        id: 'SharedArrayBuffer'
                    },
                    {
                        id: 'DataView'
                    },
                    {
                        id: 'Atomics'
                    },
                    {
                        id: 'JSON'
                    },
                ]
            },
            {
                id: 'Control Abstraction Objects',
                children: [{
                        id: 'Iteration',
                    },
                    {
                        id: 'GenerationFunction',
                    },
                    {
                        id: 'AsyncGeneratorFunction',
                    },
                    {
                        id: 'Generator',
                    },
                    {
                        id: 'AsyncGenerator',
                    },
                    {
                        id: 'Promise'
                    },
                    {
                        id: 'AsyncFunction',
                    },
                ]
            },
            {
                id: 'Reflection',
                children: [{
                        id: 'Reflect',
                    },
                    {
                        id: 'Proxy',
                    },
                    {
                        id: 'Module Namespace',
                    },
                ]
            },
        ]
    };
    console.log({...data});

    function navigateNode(node) {
        console.log('navigateNode:', node)
        const nodeObject = globalThis[node.id];

        if (!node.children && nodeObject) {
            node.children = [];
            for (const propertyName of Object.getOwnPropertyNames(nodeObject)) {
                let property = Object.getOwnPropertyDescriptor(nodeObject, propertyName);

                if (property.hasOwnProperty('value') && property.value instanceof Object) {
                    node.children.push({
                        id: propertyName,
                    });
                }

                if (property.hasOwnProperty('get') && property.get instanceof Object) {
                    node.children.push({
                        id: propertyName,
                    });
                }

                if (property.hasOwnProperty('set') && property.set instanceof Object) {
                    node.children.push({
                        id: propertyName,
                    });
                }
            }
        }

        if (node.children) {
            for (const child of node.children) {
                navigateNode(child);
            }
        } else {
            return
        }
    }

    navigateNode(data);

    console.log(data);

    const set = new Set();
    const globalObjectsNames = [
        'eval',
        'isFinite',
        'isNaN',
        'parseFloat',
        'parseInt',
        'decodeURI',
        'decodeURIComponent',
        'encodeURI',
        'encodeURIComponent',
        'Array',
        'Date',
        'RegExp',
        'Promise',
        'Proxy',
        'Map',
        'WeakMap',
        'Set',
        'WeakSet',
        'Function',
        'Boolean',
        'String',
        'Number',
        'Symbol',
        'Object',
        'Error',
        'EvalError',
        'RangeError',
        'ReferenceError',
        'SyntaxError',
        'TypeError',
        'URIError',
        'ArrayBuffer',
        'SharedArrayBuffer',
        'DataView',
        'Float32Array',
        'Float64Array',
        'Int8Array',
        'Int16Array',
        'Int32Array',
        'Uint8Array',
        'Uint16Array',
        'Uint32Array',
        'Uint8ClampedArray',
        'Atomics',
        'JSON',
        'Math',
        'Reflect'
    ];
    const queue = [];
    for (const p of globalObjectsNames) {
        queue.push({
            path: [p],
            object: this[p]
        })
    }

    let current;

    while (queue.length) {
        current = queue.shift();
        console.log(current.path.join(','));
        if (set.has(current.object)) {
            continue;
        }
        set.add(current.object);

        for (const p of Object.getOwnPropertyNames(current.object)) {
            let property = Object.getOwnPropertyDescriptor(current.object, p);

            if (property.hasOwnProperty('value') && property.value instanceof Object) {
                queue.push({
                    path: current.path.concat([p]),
                    object: property.value
                });
            }

            if (property.hasOwnProperty('get') && property.get instanceof Object) {
                queue.push({
                    path: current.path.concat([p]),
                    object: property.get
                });
            }

            if (property.hasOwnProperty('set') && property.set instanceof Object) {
                queue.push({
                    path: current.path.concat([p]),
                    object: property.set
                });
            }
        }
    }

    console.log('set:', set);

    const width = document.getElementById('container').scrollWidth;
    const height = document.getElementById('container').scrollHeight || screen.height - 200;
    const graph = new G6.TreeGraph({
        container: 'container',
        width,
        height,
        modes: {
            default: [{
                    type: 'collapse-expand',
                    onChange: function onChange(item, collapsed) {
                        const data = item.get('model').data;
                        data.collapsed = collapsed;
                        return true;
                    },
                },
                'drag-canvas',
                'zoom-canvas',
            ],
        },
        defaultNode: {
            size: 26,
            anchorPoints: [
                [0, 0.5],
                [1, 0.5],
            ],
            style: {
                fill: '#C6E5FF',
                stroke: '#5B8FF9',
            },
        },
        defaultEdge: {
            type: 'cubic-horizontal',
            style: {
                stroke: '#A3B1BF',
            },
        },
        layout: {
            type: 'compactBox',
            direction: 'LR',
            getId: function getId(d) {
                return d.id;
            },
            getHeight: function getHeight() {
                return 16;
            },
            getWidth: function getWidth() {
                return 16;
            },
            getVGap: function getVGap() {
                return 10;
            },
            getHGap: function getHGap() {
                return 100;
            },
        },
    });

    graph.node(function (node) {
        return {
            label: node.id,
            labelCfg: {
                offset: 10,
                position: node.children && node.children.length > 0 ? 'left' : 'right',
            },
        };
    });

    graph.data(data);
    graph.render();
    graph.fitView();
</script>